import{o as $,c as P,b as l,_ as ie,u as ue,r as o,g as W,h as ce,i as re,j as de,a as f,w as R,t as Y,F as ve,E as fe,f as he,k as me,l as Z,n as ge}from"./index-CwXfxpYW.js";import{a as _e,b as pe,f as z,c as we,N as xe}from"./NavLogo-C23wWtN6.js";const ke={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200",class:"icon",viewBox:"0 0 1024 1024"};function Me(S,h){return $(),P("svg",ke,h[0]||(h[0]=[l("path",{fill:"currentColor",d:"M512 1024A512 512 0 1 1 512 0a512 512 0 0 1 0 1024M383.232 287.616v448l384-223.104z"},null,-1)]))}const Ce={render:Me},ye={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200",class:"icon",viewBox:"0 0 1024 1024"};function Te(S,h){return $(),P("svg",ye,h[0]||(h[0]=[l("path",{fill:"currentColor",d:"M512 1024A512 512 0 1 1 512 0a512 512 0 0 1 0 1024M320 320v384h128V320zm256 0v384h128V320z"},null,-1)]))}const be={render:Te},Ee={id:"container"},Ie={class:"flex audio-image-box flex-wrap justify-between"},Be={id:"custom-controls"},Ae={class:"flex justify-center align-center my-2"},Le={class:"flex align-center"},We={class:"flex align-center"},Re={class:"mr-1"},ze={class:"ml-2"},$e=["src"],Pe={__name:"Audio",setup(S){const h=ue(),ee=o(_e(h.params.teamId*1)),j=W(()=>we(ee.value.id)),b=o(0),p=W(()=>j.value[b.value]),D=o(null),w=o(null),i=o(null),g=o([]),x=o(0),n=o(null),v=o(null),m=o(!1),E=o(!1),I=o(0),k=o(0),M=o(0),te=o(0),N=o(z(0)),ne=W(()=>z(M.value));let V;ce(()=>{const e=n.value;i.value=w.value.getContext("2d"),B(),H(),e.addEventListener("loadedmetadata",X),e.addEventListener("timeupdate",A),e.addEventListener("ended",F),window.addEventListener("resize",B),V=setInterval(A,100)}),re(()=>{const e=n.value;e.removeEventListener("loadedmetadata",X),e.removeEventListener("timeupdate",A),e.removeEventListener("ended",F),window.removeEventListener("resize",B),clearInterval(V)}),de(p,e=>{e&&ge(()=>{H(),oe()})});function F(){m.value=!1}function B(){const e=D.value;w.value.width=e.clientWidth,w.value.height=e.clientHeight,C()}function H(){var e;g.value=((e=pe.find(t=>t.id===p.value.id))==null?void 0:e.colors)||[],x.value=0}function C(){if(!i.value||g.value.length===0)return;const{width:e,height:t}=w.value,a=g.value.length;let s=1,u=a,_=1/0;for(let c=1;c<=a;c++){const y=Math.ceil(a/c),L=e/y,O=t/c,T=Math.abs(L/O-1);T<_&&(_=T,s=c,u=y)}const r=Math.floor(e/u),d=Math.floor(t/s);i.value.clearRect(0,0,e,t),g.value.forEach((c,y)=>{const L=Math.floor(y/u),T=y%u*r,Q=L*d;i.value.fillStyle=`rgba(${c.join(",")})`,i.value.fillRect(T,Q,r,d),se(c)&&(i.value.strokeStyle="rgba(200, 200, 200, 0.5)",i.value.lineWidth=1,i.value.strokeRect(T,Q,r,d))}),ae(s,u,r,d)}function ae(e,t,a,s){if(!i.value||g.value.length===0)return;const u=Math.floor(x.value/t),r=x.value%t*a,d=u*s;i.value.strokeStyle="red",i.value.lineWidth=3,i.value.strokeRect(r,d,a,s)}function X(){B(),M.value=Math.ceil(n.value.duration)}function oe(){m.value=!1,k.value=0,I.value=0,n.value.currentTime=0,C(),n.value.load(),U()}function U(){m.value?n.value.pause():n.value.play(),m.value=!m.value}function A(){if(!n.value)return;const e=n.value.currentTime;N.value=z(e);const t=n.value.duration;k.value=e/t*100,I.value=k.value/100*v.value.clientWidth,te.value=Math.floor(e/t*M.value);const a=Math.floor(e/t*g.value.length);a!==x.value&&(x.value=a,C())}function q(){E.value=!0,J(event)}function G(){E.value=!1}function J(){if(E.value){const e=v.value.getBoundingClientRect(),t=event.clientX-e.left,a=Math.max(0,Math.min(t/v.value.clientWidth,1));k.value=a*100,I.value=a*v.value.clientWidth,n.value.currentTime=a*n.value.duration,Math.floor(n.value.currentTime/n.value.duration*M.value),C()}}function le(){if(E.value){const e=event.touches[0],t=v.value.getBoundingClientRect(),a=e.clientX-t.left,s=Math.max(0,Math.min(a/v.value.clientWidth,1));k.value=s*100,I.value=s*v.value.clientWidth,n.value.currentTime=s*n.value.duration,Math.floor(n.value.currentTime/n.value.duration*M.value),C()}}function K(e){b.value+=e}function se(e){return e[0]>240&&e[1]>240&&e[2]>240}return(e,t)=>{var u,_,r,d;const a=fe,s=he;return $(),P(ve,null,[f(xe,{"has-back":""}),l("div",Ee,[l("div",Ie,[l("div",{ref_key:"canvasContainer",ref:D,class:"canvas-container"},[l("canvas",{ref_key:"canvas",ref:w},null,512)],512),f(a,{class:"audio-image","zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[(u=p.value)==null?void 0:u.image],fit:"cover","initial-index":0,src:(_=p.value)==null?void 0:_.image},null,8,["preview-src-list","src"])]),l("div",Be,[l("div",Ae,[l("div",Le,[f(s,{onClick:t[0]||(t[0]=c=>K(-1)),link:"",disabled:b.value<=0},{default:R(()=>[f(a,{src:"/icon/left-arrow.png"})]),_:1},8,["disabled"]),f(s,{link:"",onClick:U,title:m.value?"Pause":"Play"},{default:R(()=>[f(me,{icon:m.value?Z(be):Z(Ce),size:40,color:"var(--el-color-success)"},null,8,["icon"])]),_:1},8,["title"]),f(s,{onClick:t[1]||(t[1]=c=>K(1)),link:"",disabled:b.value>=(((r=j.value)==null?void 0:r.length)||0)-1},{default:R(()=>[f(a,{src:"/icon/right-arrow.png"})]),_:1},8,["disabled"])])]),l("div",We,[l("div",Re,Y(N.value),1),l("div",{id:"custom-track",class:"flex align-center",onMousedown:q,onMouseup:G,onMousemove:J,ref_key:"customTrack",ref:v,onTouchstart:q,onTouchend:G,onTouchmove:le},t[2]||(t[2]=[l("div",{id:"progress"},null,-1),l("div",{id:"drag-handle"},null,-1)]),544),l("div",ze,Y(ne.value),1)])]),l("audio",{ref_key:"audio",ref:n,src:(d=p.value)==null?void 0:d.audio},null,8,$e)])],64)}}},De=ie(Pe,[["__scopeId","data-v-8bcb00ed"]]);export{De as default};
